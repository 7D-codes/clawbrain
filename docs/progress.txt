[2026-02-05] Agent B - Backend API Developer

## Completed: CB-003 + CB-008 - File System API with Security

### Files Created:

1. **src/lib/security.ts** (3.7 KB)
   - SANDBOX_ROOT constant pointing to ~/clawdbrain/
   - `sanitizePath()` - Path traversal protection
   - `isValidUUID()` - UUID validation for task IDs
   - `getTaskPath()` - Safe task file path resolution
   - `validateContent()` - Content sanitization (null byte detection, size limits)
   - `PathValidationError` - Custom error class with error codes

2. **src/lib/file-store.ts** (10 KB)
   - `listTasks()` - List all tasks with sorting by updated date
   - `getTask()` - Get single task by ID
   - `createTask()` - Create new task with auto-generated UUID
   - `updateTask()` - Update task with timestamp-based conflict detection
   - `deleteTask()` - Delete task by ID
   - `atomicWriteFile()` - Atomic write pattern (temp → rename → fsync)
   - YAML frontmatter parsing/serialization
   - Task interface and types
   - FileStoreError with HTTP status codes

3. **src/app/api/tasks/route.ts** (5 KB)
   - GET /api/tasks - List all tasks with pagination, status/project filters
   - POST /api/tasks - Create new task with Zod validation
   - Returns 201 with Location header on create
   - Query params: page, limit, status, project

4. **src/app/api/tasks/[id]/route.ts** (5 KB)
   - GET /api/tasks/[id] - Get single task
   - PATCH /api/tasks/[id] - Partial update task
   - DELETE /api/tasks/[id] - Delete task
   - UUID validation on all routes
   - Zod validation for update operations

### Security Features:

- ✅ Sandboxed to ~/clawdbrain/ only
- ✅ Path traversal protection (rejects ../, absolute paths)
- ✅ UUID-only task IDs (prevents directory traversal via IDs)
- ✅ Atomic writes (write to .tmp file → fsync → rename)
- ✅ Conflict detection via timestamps (updated field auto-refreshed)
- ✅ Proper error handling with 400, 403, 404, 500 status codes
- ✅ Content validation (null byte injection protection)
- ✅ Size limits (10MB default for content)

### API Response Codes:

- 200: Success (GET, DELETE)
- 201: Created (POST with Location header)
- 400: Bad Request (invalid JSON, validation errors, invalid UUID)
- 403: Forbidden (path traversal attempt)
- 404: Not Found (task doesn't exist)
- 500: Internal Server Error

### Dependencies Used:

- uuid (v4) - For generating task IDs
- zod - For request validation
- fs/promises - For atomic file operations
- path, os - For sandbox path resolution

### Notes:

- All file operations use the atomic write pattern to prevent corruption
- Tasks are stored as markdown files with YAML frontmatter
- Last-write-wins strategy implemented for MVP (timestamp-based)
- Pagination defaults: page=1, limit=50, max=100
